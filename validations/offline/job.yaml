# Core validation test for CK

- job:
    name: 'validate-ck'
    project-type: freestyle
    scm:
      - k8s-jenkins-bm
    parameters:
      !include: global-parameters.yaml
    # triggers:
    #     - timed: "0 12 * * *"
    wrappers:
      - ansicolor
      - workspace-cleanup
    builders:
      - virtualenvwrapper
      - shell: |-
          #!/bin/bash
          set -eux
          cat <<- EOF > $WORKSPACE/deployment.toml
          [Juju.bootstrap]
          constraints = "$JUJU_BOOTSTRAP_CONSTRAINTS"
          debug = "$JUJU_BOOTSTRAP_DEBUG"
          disable_add_model = "$JUJU_BOOTSTRAP_DISABLE_ADD_MODEL"
          [Juju.deploy]
          bundle = "$JUJU_DEPLOY_BUNDLE"
          overlay = \"""
          applications:
            kubernetes-master:
              options:
                channel: $SNAP_VERSION
            kubernetes-worker:
              options:
                channel: $SNAP_VERSION
          """
          EOF

          ogc --spec validations/ck/spec.toml plugin-deps --installable | sh -
          ogc --spec validations/ck/spec.toml \
              --spec $WORKSPACE/deployment.toml \
              --debug execute
      - virtualenvwrapper-deactivate
