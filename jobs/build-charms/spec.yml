[Info]
name = "Build charms and bundles"
description = """
Builds the charms and bundles that make up the Charmed Kubernetes deployment.
"""

[Info.mkdocs]
destination = "builders/charms/index.md"

[Env]
name = "Env"
description = "This sets up the environment"
properties_file = "build-env.properties"
deps = ["pip:requirements.txt", "snap:charm/latest/edge:classic", "apt:docker.io"]

[[Runner]]
name = "Building Charms"
description = """
Build the charms that make up a Juju bundle
"""
env_requires = ["CHARM_BUILD_DIR",
                "CHARM_LAYERS_DIR",
                "CHARM_INTERFACES_DIR",
                "CHARM_CACHE_DIR",
                "CHARM_BRANCH",
                "FILTER_BY_TAG",
                "LAYER_BRANCH",
                "LAYER_INDEX",
                "LAYER_LIST",
                "CHARM_LIST",
                "RESOURCE_SPEC",
                "BUNDLE_LIST",
                "BUNDLE_REPO",
                "TO_CHANNEL",
                "TMPDIR",
                "WORKSPACE"]
entry_point = ["python3", "-m", "charms"]
args = ["build", "--charm-list", "$CHARM_LIST",
                 "--charm-branch", "$CHARM_BRANCH",
                 "--to-channel", "$TO_CHANNEL",
                 "--resource-spec", "$RESOURCE_SPEC",
                 "--filter-by-tag", "$FILTER_BY_TAG",
                 "--layer-index", "$LAYER_INDEX",
                 "--layer-list", "$LAYER_LIST",
                 "--layer-branch", "$LAYER_BRANCH"]
tags = ["build-charms"]

[[Runner]]
name = "Building bundles"
description = """
Build the bundles
"""
env_requires = ["FILTER_BY_TAG",
                "BUNDLE_LIST",
                "BUNDLE_REPO",
                "TO_CHANNEL",
                "TMPDIR",
                "WORKSPACE"]
entry_point = ["python3", "-m", "charms"]
args = ["build-bundles", "--to-channel", "$TO_CHANNEL",
                         "--bundle-list", "$BUNDLE_LIST",
                         "--filter-by-tag", "$FILTER_BY_TAG"]
tags = ["build-bundles"]